var Bindery=function(){"use strict";function e(e,t){for(var n=[],r=0;r<e.length;r++)t(e[r])&&n.push(e[r]);return n}function t(e){return!!e}function n(){}function r(){}function i(e){this.el=e,this.styles=[]}function o(e,t){e&&(this.name=e,this.value=t||"")}function s(){var e=this;this.style=new i(this),this.classList=m(this),this.childNodes=[],this.attributes=[],this.dataset={},this.className="",this._setProperty=function(t,n,r,i){var o=e._getProperty(t,r);o?o.value=String(i):t.push("function"==typeof n?new n(r.toLowerCase(),String(i)):n)},this._getProperty=function(e,t){if(t){t=t.toLowerCase();for(var n=0;n<e.length;n++)if(t==e[n].name)return e[n]}}}function a(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function l(e){return a(e).replace(/"/g,"&quot;")}function u(){}function c(){}function d(e){e.__defineGetter__("parentNode",function(){return this.parentElement})}var p="v2.0.0-alpha.9.4",h=function(e){var t=String.prototype.split,n=/()??/.exec("")[1]===e;return function(r,i,o){if("[object RegExp]"!==Object.prototype.toString.call(i))return t.call(r,i,o);var s,a,l,u,c=[],d=(i.ignoreCase?"i":"")+(i.multiline?"m":"")+(i.extended?"x":"")+(i.sticky?"y":""),p=0,i=new RegExp(i.source,d+"g");for(r+="",n||(s=new RegExp("^"+i.source+"$(?!\\s)",d)),o=o===e?-1>>>0:o>>>0;(a=i.exec(r))&&!((l=a.index+a[0].length)>p&&(c.push(r.slice(p,a.index)),!n&&a.length>1&&a[0].replace(s,function(){for(var t=1;t<arguments.length-2;t++)arguments[t]===e&&(a[t]=e)}),a.length>1&&a.index<r.length&&Array.prototype.push.apply(c,a.slice(1)),u=a[0].length,p=l,c.length>=o));)i.lastIndex===a.index&&i.lastIndex++;return p===r.length?!u&&i.test("")||c.push(""):c.push(r.slice(p)),c.length>o?c.slice(0,o):c}}(),f=[].indexOf,g=function(e,t){if(f)return e.indexOf(t);for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1},m=function(n){function r(e){var t=s();g(t,e)>-1||(t.push(e),a(t))}function i(e){var t=s(),n=g(t,e);-1!==n&&(t.splice(n,1),a(t))}function o(e){return g(s(),e)>-1}function s(){return e(n.className.split(" "),t)}function a(e){var t=e.length;n.className=e.join(" "),u.length=t;for(var r=0;r<e.length;r++)u[r]=e[r];delete e[t]}var l=n.classList;if(l)return l;var u={add:r,remove:i,contains:o,toggle:function(e){return o(e)?(i(e),!1):(r(e),!0)},toString:function(){return n.className},length:0,item:function(e){return s()[e]||null}};return u},v={className:"class",htmlFor:"for"},y={accept:new Set(["form","input"]),"accept-charset":new Set(["form"]),accesskey:"GLOBAL",action:new Set(["form"]),align:new Set(["applet","caption","col","colgroup","hr","iframe","img","table","tbody","td","tfoot","th","thead","tr"]),alt:new Set(["applet","area","img","input"]),async:new Set(["script"]),autocomplete:new Set(["form","input"]),autofocus:new Set(["button","input","keygen","select","textarea"]),autoplay:new Set(["audio","video"]),autosave:new Set(["input"]),bgcolor:new Set(["body","col","colgroup","marquee","table","tbody","tfoot","td","th","tr"]),border:new Set(["img","object","table"]),buffered:new Set(["audio","video"]),challenge:new Set(["keygen"]),charset:new Set(["meta","script"]),checked:new Set(["command","input"]),cite:new Set(["blockquote","del","ins","q"]),class:"GLOBAL",code:new Set(["applet"]),codebase:new Set(["applet"]),color:new Set(["basefont","font","hr"]),cols:new Set(["textarea"]),colspan:new Set(["td","th"]),content:new Set(["meta"]),contenteditable:"GLOBAL",contextmenu:"GLOBAL",controls:new Set(["audio","video"]),coords:new Set(["area"]),data:new Set(["object"]),datetime:new Set(["del","ins","time"]),default:new Set(["track"]),defer:new Set(["script"]),dir:"GLOBAL",dirname:new Set(["input","textarea"]),disabled:new Set(["button","command","fieldset","input","keygen","optgroup","option","select","textarea"]),download:new Set(["a","area"]),draggable:"GLOBAL",dropzone:"GLOBAL",enctype:new Set(["form"]),for:new Set(["label","output"]),form:new Set(["button","fieldset","input","keygen","label","meter","object","output","progress","select","textarea"]),formaction:new Set(["input","button"]),headers:new Set(["td","th"]),height:new Set(["canvas","embed","iframe","img","input","object","video"]),hidden:"GLOBAL",high:new Set(["meter"]),href:new Set(["a","area","base","link"]),hreflang:new Set(["a","area","link"]),"http-equiv":new Set(["meta"]),icon:new Set(["command"]),id:"GLOBAL",ismap:new Set(["img"]),itemprop:"GLOBAL",keytype:new Set(["keygen"]),kind:new Set(["track"]),label:new Set(["track"]),lang:"GLOBAL",language:new Set(["script"]),list:new Set(["input"]),loop:new Set(["audio","bgsound","marquee","video"]),low:new Set(["meter"]),manifest:new Set(["html"]),max:new Set(["input","meter","progress"]),maxlength:new Set(["input","textarea"]),media:new Set(["a","area","link","source","style"]),method:new Set(["form"]),min:new Set(["input","meter"]),multiple:new Set(["input","select"]),muted:new Set(["video"]),name:new Set(["button","form","fieldset","iframe","input","keygen","object","output","select","textarea","map","meta","param"]),novalidate:new Set(["form"]),open:new Set(["details"]),optimum:new Set(["meter"]),pattern:new Set(["input"]),ping:new Set(["a","area"]),placeholder:new Set(["input","textarea"]),poster:new Set(["video"]),preload:new Set(["audio","video"]),radiogroup:new Set(["command"]),readonly:new Set(["input","textarea"]),rel:new Set(["a","area","link"]),required:new Set(["input","select","textarea"]),reversed:new Set(["ol"]),rows:new Set(["textarea"]),rowspan:new Set(["td","th"]),sandbox:new Set(["iframe"]),scope:new Set(["th"]),scoped:new Set(["style"]),seamless:new Set(["iframe"]),selected:new Set(["option"]),shape:new Set(["a","area"]),size:new Set(["input","select"]),sizes:new Set(["img","link","source"]),span:new Set(["col","colgroup"]),spellcheck:"GLOBAL",src:new Set(["audio","embed","iframe","img","input","script","source","track","video"]),srcdoc:new Set(["iframe"]),srclang:new Set(["track"]),srcset:new Set(["img"]),start:new Set(["ol"]),step:new Set(["input"]),style:"GLOBAL",summary:new Set(["table"]),tabindex:"GLOBAL",target:new Set(["a","area","base","form"]),title:"GLOBAL",type:new Set(["button","input","command","embed","object","script","source","style","menu"]),usemap:new Set(["img","input","object"]),value:new Set(["button","option","input","li","meter","progress","param"]),width:new Set(["canvas","embed","iframe","img","input","object","video"]),wrap:new Set(["textarea"])},w={isStandardAttribute:function(e,t){t=t.toLowerCase();var n=y[e.toLowerCase()];return!!n&&("GLOBAL"===n||n.has(t))},propToAttr:function(e){return v[e]||e}};n.prototype.createTextNode=function(e){var t=new u;return t.textContent=e,t.nodeName="#text",t.nodeType=3,t},n.prototype.createElement=function(e){var t=new s;return t.nodeName=t.tagName=e,t},n.prototype.createComment=function(e){var t=new c;return t.data=e,t},u.prototype=new r,s.prototype=new r,c.prototype=new r,i.prototype.setProperty=function(e,t){this.el._setProperty(this.styles,{name:e,value:t})},i.prototype.getProperty=function(e){return this.el._getProperty(this.styles,e)},i.prototype.__defineGetter__("cssText",function(){var e="";return this.styles.forEach(function(t){e+=t.name+":"+t.value+";"}),e}),i.prototype.__defineSetter__("cssText",function(e){this.styles.length=0,e.split(";").forEach(function(e){var t=e.indexOf(":");if(t){var n=e.slice(0,t).trim(),r=e.slice(t+1).trim();this.setProperty(n,r)}},this)}),s.prototype.nodeType=1,s.prototype.appendChild=function(e){return e.parentElement=this,this.childNodes.push(e),e},s.prototype.setAttribute=function(e,t){"style"==e?this.style.cssText=t:this._setProperty(this.attributes,o,e,t)},s.prototype.getAttribute=function(e){if("style"==e)return this.style.cssText;var t=this._getProperty(this.attributes,e);return void 0!==t?t.value:null},s.prototype.removeAttribute=function(e){if("class"===e)delete this.className;else for(var t=0,n=this.attributes.length;t<n;t++)if(this.attributes[t].name===e){this.attributes.splice(t,1);break}},s.prototype.replaceChild=function(e,t){var n=this,r=!1;if(this.childNodes.forEach(function(i,o){i===t&&(n.childNodes[o]=e,e.parentElement=this,r=!0)}),r)return t},s.prototype.removeChild=function(e){var t=this,n=!0;if(this.childNodes.forEach(function(r,i){r===e&&(t.childNodes.splice(i,1),e.parentElement=null,n=!0)}),n)return e},s.prototype.insertBefore=function(e,t){var n=this.childNodes;if(null===t)n.push(e);else for(var r=0,i=n.length;r<i;r++)if(n[r]===t){0===r?n.unshift(e):n.splice(r,0,e);break}return e.parentElement=this,e},s.prototype.addEventListener=function(e,t,n,r){},s.prototype.removeEventListener=function(e,t,n){},s.prototype.insertAdjacentHTML=function(e,t){},s.prototype.__defineGetter__("innerHTML",function(){var e=this.childNodes.html||"";return this.childNodes.forEach(function(t){e+=t.outerHTML||t.textContent}),e}),s.prototype.__defineSetter__("innerHTML",function(e){this.childNodes.length=0,this.childNodes.html=e}),s.prototype.__defineGetter__("outerHTML",function(){function e(e){var t,n=[];return e.forEach(function(e){t="style"!=e.name?e.value:r.style.cssText,n.push(e.name+'="'+l(t)+'"')}),n.length?" "+n.join(" "):""}function t(e,t){return!r.getAttribute(t)&&!("className"===e&&!r[e])}var n=[],r=this,i={AREA:!0,BASE:!0,BR:!0,COL:!0,EMBED:!0,HR:!0,IMG:!0,INPUT:!0,KEYGEN:!0,LINK:!0,META:!0,PARAM:!0,SOURCE:!0,TRACK:!0,WBR:!0},o=this.style.cssText?this.attributes.concat([{name:"style"}]):this.attributes;return n.push("<"+this.nodeName+function(){var n=[];for(var i in r){var o=w.propToAttr(i);r.hasOwnProperty(i)&&-1!==["string","boolean","number"].indexOf(typeof r[i])&&w.isStandardAttribute(o,r.nodeName)&&t(i,o)&&n.push({name:o,value:r[i]})}return n?e(n):""}()+e(o)+function(e){var t=[];return Object.keys(e).forEach(function(n){t.push("data-"+n+'="'+l(e[n])+'"')}),t.length?" "+t.join(" "):""}(this.dataset)+">"),i[this.nodeName.toUpperCase()]||(n.push(this.innerHTML),n.push("</"+this.nodeName+">")),n.join("")}),s.prototype.__defineGetter__("textContent",function(){var e="";return this.childNodes.forEach(function(t){e+=t.textContent}),e}),s.prototype.__defineSetter__("textContent",function(e){var t=new u;return t.textContent=e,this.childNodes=[t],e}),s.prototype.addEventListener=function(e,t){},s.prototype.nodeValue=null,u.prototype.nodeType=3,u.prototype.nodeName="#text",u.prototype.__defineGetter__("textContent",function(){return a(this.value||"")}),u.prototype.__defineSetter__("textContent",function(e){this.value=e}),u.prototype.__defineGetter__("nodeValue",function(){return a(this.value||"")}),u.prototype.__defineSetter__("nodeValue",function(e){this.value=e}),u.prototype.__defineGetter__("length",function(){return(this.value||"").length}),u.prototype.replaceData=function(e,t,n){this.value=this.value.slice(0,e)+n+this.value.slice(e+t)},c.prototype.nodeType=8,c.prototype.nodeName="#comment",c.prototype.__defineGetter__("data",function(){return this.value}),c.prototype.__defineSetter__("data",function(e){this.value=e}),c.prototype.__defineGetter__("outerHTML",function(){return"\x3c!--"+a(this.value||"")+"--\x3e"}),c.prototype.__defineGetter__("nodeValue",function(){return a(this.value||"")}),c.prototype.__defineSetter__("nodeValue",function(e){this.value=e}),d(s.prototype),d(c.prototype),d(u.prototype),d(r.prototype);var b={Document:n,Node:r,Element:s,Comment:c,Text:u,document:new n},k=function(e,t){return t={exports:{}},e(t,t.exports),t.exports}(function(e){function t(){function e(){function e(o){var u;if(null==o);else if("string"==typeof o)l?l.appendChild(u=s.createTextNode(o)):function(e){var t=h(e,/([\.#]?[^\s#.]+)/);/^\.|#/.test(t[1])&&(l=s.createElement("div")),r(t,function(e){var t=e.substring(1,e.length);e&&(l?"."===e[0]?m(l).add(t):"#"===e[0]&&l.setAttribute("id",t):l=s.createElement(e))})}(o);else if("number"==typeof o||"boolean"==typeof o||o instanceof Date||o instanceof RegExp)l.appendChild(u=s.createTextNode(o.toString()));else if(i(o))r(o,e);else if(n(o))l.appendChild(u=o);else if(o instanceof a)l.appendChild(u=o);else if("object"==typeof o)for(var c in o)if("function"==typeof o[c])/^on\w+/.test(c)?function(e,n){l.addEventListener?(l.addEventListener(e.substring(2),n[e],!1),t.push(function(){l.removeEventListener(e.substring(2),n[e],!1)})):(l.attachEvent(e,n[e]),t.push(function(){l.detachEvent(e,n[e])}))}(c,o):(l[c]=o[c](),t.push(o[c](function(e){l[c]=e})));else if("style"===c)if("string"==typeof o[c])l.style.cssText=o[c];else for(var d in o[c])!function(e,n){if("function"==typeof n)l.style.setProperty(e,n()),t.push(n(function(t){l.style.setProperty(e,t)}));else var r=o[c][e].match(/(.*)\W+!important\W*$/);r?l.style.setProperty(e,r[1],"important"):l.style.setProperty(e,o[c][e])}(d,o[c][d]);else if("attrs"===c)for(var p in o[c])l.setAttribute(p,o[c][p]);else"data-"===c.substr(0,5)?l.setAttribute(c,o[c]):l[c]=o[c];else if("function"==typeof o){p=o();l.appendChild(u=n(p)?p:s.createTextNode(p)),t.push(o(function(e){n(e)&&u.parentElement?(u.parentElement.replaceChild(e,u),u=e):u.textContent=e}))}return u}for(var o=[].slice.call(arguments),l=null;o.length;)e(o.shift());return l}var t=[];return e.cleanup=function(){for(var e=0;e<t.length;e++)t[e]();t.length=0},e}function n(e){return e&&e.nodeName&&e.nodeType}function r(e,t){if(e.forEach)return e.forEach(t);for(var n=0;n<e.length;n++)t(e[n],n)}function i(e){return"[object Array]"==Object.prototype.toString.call(e)}var o="undefined"==typeof window?b:window,s=o.document,a=o.Text;(e.exports=t()).context=t}),x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},C=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),_=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var s=i.get;if(void 0!==s)return s.call(r)},L=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},E=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},z=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},P=function(e){var t=e.tagName.toLowerCase(),n=e.id?"#"+e.id:"",r="";e.classList.length>0&&(r="."+[].concat(z(e.classList)).join("."));var i="";return n.length<1&&r.length<2&&(i='("'+e.textContent.substr(0,30).replace(/\s+/g," ")+'...")'),t+n+r+i},O=function(e){return"📖-"+e},A=function(e){return"."+O(e)},B=function(e){return"."===e[0]?A(e.substr(1)):O(e)},T=function(e){return e[e.length-1]},M=function(e){var t="",n=e[0],r=!1;return e.forEach(function(i,o){var s=o===e.length-1,a=i===n+1;0===o?t+=""+i:s?t+=a?"–"+i:r?"–"+n+", "+i:", "+i:a?r=!0:r&&!a?(r=!1,t+="–"+n+", "+i):t+=", "+i,n=i}),t},N=/^([+-]?[0-9]+(.?[0-9]+)?)(px|in|cm|mm|pt|pc)$/,I=function(e){return N.test(e)},F=function(e){Object.keys(e).forEach(function(t){if(!I(e[t]))throw"number"==typeof e[t]?Error("Size is missing units { "+t+": "+e[t]+" }"):Error("Invalid size { "+t+": "+e[t]+" }")})},R=function(e){var t=e.match(N);return{val:Number(t[1]),unit:t[3]}},j=function(e,t){return Object.keys(e).forEach(function(n){if(t[n]){var r=e[n],i=t[n];i(r)||console.error("Bindery: For property '"+t.name+"."+n+"', "+JSON.stringify(r)+" is not a valid value of type "+i.name)}else console.error("Bindery: '"+t.name+"' doesn't have property '"+n+"'")}),!0},H=function(e){return"object"===(void 0===e?"undefined":x(e))},G={enum:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=function(e){return t.includes(e)};return Object.defineProperty(r,"name",{writable:!0}),r.name="enum ( '"+t.join("' | '")+"' )",r},any:function(){return!0},string:function(e){return"string"==typeof e},length:function(e){return I(e)},bool:function(e){return"boolean"==typeof e},func:function(e){return"function"==typeof e},obj:H,array:function(e){return Array.isArray(e)},shape:function(e){return function(t){return H(t)&&j(t,e)}},validate:j},D=function(e){for(var t=window.location.search.substring(1).split("&"),n=0;n<t.length;n+=1){var r=t[n].split("=");if(r[0]===e)return r[1]}return!1},q=function(){function e(){S(this,e),this.pages=[],this.queued=[],this.isComplete=!1}return C(e,[{key:"pagesForSelector",value:function(e){return this.pagesForTest(function(t){return t.element.querySelector(e)})}},{key:"pagesForTest",value:function(e){return this.pages.filter(function(t){return e(t.element)}).map(function(e){return e.number})}},{key:"onComplete",value:function(e){this.isComplete?e():this.queued.push(e)}},{key:"setCompleted",value:function(){this.isComplete=!0,this.queued.forEach(function(e){e()}),this.queued=[]}},{key:"pageCount",get:function(){return this.pages.length}}]),e}(),V=function(){function e(){S(this,e),this.flowContent=k(B(".content")),this.flowBox=k(B(".flowbox"),this.flowContent),this.footer=k(B(".footer")),this.background=k(B(".background")),this.element=k(B(".page")+B(".page-size"),this.background,this.flowBox,this.footer)}return C(e,[{key:"overflowAmount",value:function(){var e=this.flowContent.offsetHeight,t=this.flowBox.offsetHeight;if(0===t)throw Error("Bindery: Trying to flow into a box of zero height.");return e-t}},{key:"hasOverflowed",value:function(){return this.overflowAmount()>-5}},{key:"setLeftRight",value:function(e){if("left"===e)this.side=e,this.element.classList.remove(B("right")),this.element.classList.add(B("left"));else{if("right"!==e)throw Error("Bindery: Setting page to invalid direction"+e);this.side=e,this.element.classList.remove(B("left")),this.element.classList.add(B("right"))}}},{key:"setPreference",value:function(e){"left"===e&&(this.alwaysLeft=!0),"right"===e&&(this.alwaysRight=!0)}},{key:"suppressErrors",get:function(){return this.suppress||!1},set:function(e){this.suppress=e,e?this.element.classList.add(B("is-overflowing")):this.element.classList.remove(B("is-overflowing"))}},{key:"isEmpty",get:function(){return!this.hasOutOfFlowContent&&""===this.flowContent.textContent.trim()&&this.flowContent.offsetHeight<1}},{key:"isLeft",get:function(){return"left"===this.side}},{key:"isRight",get:function(){return"right"===this.side}}],[{key:"isSizeValid",value:function(){document.body.classList.remove(B("viewing"));var t=new e,n=document.querySelector(B(".measure-area"));n||(n=document.body.appendChild(k(B(".measure-area")))),n.innerHTML="",n.appendChild(t.element);var r=t.flowBox.getBoundingClientRect();return n.parentNode.removeChild(n),r.height>100&&r.width>100}}]),e}(),U=function e(t){var n=this;S(this,e),this.name=t.name?t.name:"Unnamed Bindery Rule",this.selector="",Object.keys(t).forEach(function(e){n[e]=t[e]})},Y=function(e){function t(e){S(this,t);var n=E(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.name="Out of Flow",n}return L(t,U),C(t,[{key:"beforeAdd",value:function(e){return e.setAttribute("data-ignore-overflow",!0),e}},{key:"afterAdd",value:function(e,t,n,r){return this.createOutOfFlowPages(e,t,r),("same"!==this.continue||t.pageInProgress.hasOutOfFlowContent)&&(n(!0),"left"!==this.continue&&"right"!==this.continue||t.pageInProgress.setPreference(this.continue)),e}}]),t}(),W=function(e){function t(e){S(this,t),e.continue=e.continue||"same",e.rotate=e.rotate||"none";var n=E(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return G.validate(e,{name:"FullBleedPage",selector:G.string,continue:G.enum("next","same","left","right"),rotate:G.enum("none","inward","outward","clockwise","counterclockwise")}),n}return L(t,Y),C(t,[{key:"createOutOfFlowPages",value:function(e,t,n){e.parentNode.removeChild(e);var r=void 0;if(t.pageInProgress.isEmpty?r=t.pageInProgress:(r=n(),t.pages.push(r)),"none"!==this.rotate){var i=k(B(".rotate-container"));i.classList.add(B("page-size-rotated")),i.classList.add(B("rotate-"+this.rotate)),i.appendChild(r.background),r.element.appendChild(i)}r.background.appendChild(e),r.hasOutOfFlowContent=!0}}]),t}(),Z=function(e){function t(e){S(this,t),e.continue=e.continue||"same",e.rotate=e.rotate||"none";var n=E(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return G.validate(e,{name:"FullBleedSpread",selector:G.string,continue:G.enum("next","same","left","right"),rotate:G.enum("none","clockwise","counterclockwise")}),n}return L(t,Y),C(t,[{key:"createOutOfFlowPages",value:function(e,t,n){var r=this;e.parentNode.removeChild(e);var i=void 0;t.pageInProgress.isEmpty?i=t.pageInProgress:(i=n(),t.pages.push(i));var o=n();t.pages.push(o),"none"!==this.rotate&&[i,o].forEach(function(e){var t=k(B(".rotate-container"));t.classList.add(B("spread-size-rotated")),t.classList.add(B("rotate-spread-"+r.rotate)),t.appendChild(e.background),e.element.appendChild(t)}),i.background.appendChild(e),i.element.classList.add(B("spread")),i.setPreference("left"),i.isOutOfFlow="same"===this.continue,i.hasOutOfFlowContent=!0,o.background.appendChild(e.cloneNode(!0)),o.element.classList.add(B("spread")),o.setPreference("right"),o.isOutOfFlow="same"===this.continue,o.hasOutOfFlowContent=!0}}]),t}(),J=function(e){function t(e){S(this,t),e.position=e.position||"before",e.continue=e.continue||"next";var n=E(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return G.validate(e,{name:"PageBreak",selector:G.string,continue:G.enum("next","left","right"),position:G.enum("before","after","both","avoid")}),n}return L(t,U),C(t,[{key:"beforeAdd",value:function(e,t,n){return"before"!==this.position&&"both"!==this.position||(t.pageInProgress.isEmpty||n(),"next"!==this.continue&&t.pageInProgress.setPreference(this.continue)),e}},{key:"afterAdd",value:function(e,t,n){if("after"===this.position||"both"===this.position){var r=n(!0);"next"!==this.continue&&r.setPreference(this.continue)}return e}},{key:"avoidSplit",get:function(){return"avoid"===this.position}}]),t}(),K=function(){function e(t){S(this,e),this.numberOfCalls=0,this.resumeLimit=1/0,this.callsSinceResume=0,this.queuedFunc=null,this.isPaused=!1,this.useDelay=t,this.delayTime=100,t&&(window.binderyDebug={pause:this.pause.bind(this),resume:this.resume.bind(this),resumeFor:this.resumeFor.bind(this),step:this.step.bind(this),finish:this.finish.bind(this)},console.log("Bindery: Debug layout with the following: \nbinderyDebug.pause() \nbinderyDebug.resume()\n binderyDebug.resumeFor(n) // pauses after n steps, \nbinderyDebug.step()"))}return C(e,[{key:"throttle",value:function(e){this.callsSinceResume+=1,this.callsSinceResume>this.resumeLimit&&this.endResume(),this.isPaused?this.queuedFunc=e:this.useDelay?setTimeout(e,this.delayTime):this.numberOfCalls<1e3?(this.numberOfCalls+=1,e()):(this.numberOfCalls=0,document.hidden?setTimeout(e,1):requestAnimationFrame(e))}},{key:"pause",value:function(){return this.isPaused?"Already paused":(this.isPaused=!0,"Paused")}},{key:"resumeDelay",value:function(){this.useDelay=!0,this.resume()}},{key:"finish",value:function(){this.useDelay=!1,this.resume()}},{key:"resume",value:function(){return this.isPaused?(this.isPaused=!1,this.queuedFunc?(this.queuedFunc(),this.queuedFunc=null,"Resuming"):"Layout complete"):"Already running"}},{key:"step",value:function(){if(!this.isPaused)return this.pause();if(this.queuedFunc){var e=this.queuedFunc,t=e.name;return this.queuedFunc=null,e(),t}return"Layout complete"}},{key:"resumeFor",value:function(e){return this.callsSinceResume=0,this.resumeLimit=e,this.resume()}},{key:"endResume",value:function(){console.log("Paused after "+this.resumeLimit),this.resumeLimit=1/0,this.callsSinceResume=0,this.pause()}}]),e}(),$=function(e,t){for(var n=t;n<e.length;n+=1)if(!e[n].isOutOfFlow)return n;return t},X=function(e,t){for(var n=e.slice(),r=0;r<n.length;r+=1){var i=n[r],o=r%2!=0;if(o&&i.alwaysRight||!o&&i.alwaysLeft)if(i.isOutOfFlow){var s=$(n,r+1),a=n[s];n.splice(s,1),n.splice(r,0,a)}else n.splice(r,0,t())}return n},Q=function(e){e.forEach(function(e,t){e.number=t+1,e.setLeftRight(t%2==0?"right":"left")});var t={h1:"",h2:"",h3:"",h4:"",h5:"",h6:""};e.forEach(function(e){e.heading={},Object.keys(t).forEach(function(n,r){var i=e.element.querySelector(n);i&&(t[n]=i.textContent,Object.keys(t).forEach(function(e,n){n>r&&(t[e]="")})),""!==t[n]&&(e.heading[n]=t[n])})})},ee=function(e){var t=function(t){t.classList.add(B("continues")),e.filter(function(e){return e.customContinuesClass}).forEach(function(e){return t.classList.add(e.customContinuesClass)})},n=function(t){t.classList.add(B("continuation")),e.filter(function(e){return e.customContinuationClass}).forEach(function(e){return t.classList.add(e.customContinuationClass)})};return function(e){for(var r=[],i=e.length-1;i>=0;i-=1){var o=e[i],s=o.cloneNode(!1);if(s.innerHTML="",t(o),n(s),"OL"===s.tagName){var a=1;o.hasAttribute("start")&&(a=parseInt(o.getAttribute("start"),10)),i<e.length-1&&"LI"===e[i+1].tagName&&(a-=1);var l=a+o.children.length;s.setAttribute("start",l)}i<e.length-1&&s.appendChild(r[i+1]),r[i]=s}return r}},te=function(e,t){var n=e.src.substring(e.src.lastIndexOf("/")+1),r=setInterval(function(){e.naturalWidth&&(clearInterval(r),t())},10);e.addEventListener("error",function(){clearInterval(r),console.error("Bindery: Image '"+n+"' failed to load."),t()}),e.src=e.src},ne=function(e){var t=e.content,n=e.rules,r=e.success,i=e.progress,o=e.error,s=e.isDebugging,a=window.performance.now(),l=0,u=new K(s),c=ee(n),d=document.body.appendChild(k(B(".measure-area"))),p=[],h=new q,f=void 0,g=void 0,m=function(){return p[0]?T(p):h.pageInProgress.flowContent},v=function(e){n.forEach(function(t){t.afterPageCreated&&t.afterPageCreated(e,h)})},y=function(){n.forEach(function(e){e.layoutStart&&e.layoutStart()})},w=function(){var e=new V;return d.appendChild(e.element),v(e),e},b=function(){h.pages=X(h.pages,w),Q(h.pages),h.pageInProgress&&N(h.pageInProgress)},x=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(h.pageInProgress&&h.pageInProgress.hasOverflowed()&&(console.warn("Bindery: Page overflowing",h.pageInProgress.element),!h.pageInProgress.suppressErrors&&!e))throw o("Moved to new page when last one is still overflowing"),Error("Bindery: Moved to new page when last one is still overflowing");if(500===h.pages.length)console.warn("Bindery: More than 500 pages, performance may be slow.");else if(1e3===h.pages.length)console.warn("Bindery: More than 1000 pages, performance may be slow.");else if(h.pages.length>9999)throw o("Maximum page count exceeded"),Error("Bindery: Maximum page count exceeded. Suspected runaway layout.");b(),p=c(p);var t=w();if(h.pageInProgress=t,f(),h.pages.push(t),p[0]&&t.flowContent.appendChild(p[0]),t.hasOverflowed()){var n=m();n?(console.error("Bindery: NextPage already overflowing, probably due to a style set on "+P(n)+". It may not fit on the page."),n.parentNode.removeChild(n)):console.error("Bindery: NextPage already overflowing.")}return t},S=n.filter(function(e){return e.selector&&e.beforeAdd}),C=n.filter(function(e){return e.selector&&e.afterAdd}),_=n.filter(function(e){return e.eachPage}),L=n.filter(function(e){return e.avoidSplit}).map(function(e){return e.selector}),E=function(e){var t=e.filter(function(e){return e instanceof Z||e instanceof W||e instanceof J}),n=e.filter(function(e){return!t.includes(e)}),r=t.find(function(e){return e instanceof Z}),i=t.find(function(e){return e instanceof W});return r?n.push(r):i?n.push(i):n.push.apply(n,z(t)),n},O=function(e){var t=e;return S.filter(function(e){return t.matches(e.selector)}).forEach(function(e){t=e.beforeAdd(t,h,x,w)}),t},A=function(e){var t=e,n=C.filter(function(e){return t.matches(e.selector)});return E(n).forEach(function(e){t=e.afterAdd(t,h,x,w,function(t){return t.parentNode.removeChild(t),x(),m().appendChild(t),e.afterAdd(t,h,x,w,function(){console.log("Couldn't apply "+e.name+" to "+P(t)+". Caused overflows twice.")})})}),t},M=function(){_.forEach(function(e){h.pages.forEach(function(t){e.eachPage(t,h)})})},N=function(e){_.forEach(function(t){t.eachPage(e,h)})},I=function e(t){return L.some(function(e){return t.matches(e)})?!(!t.hasAttribute("data-bindery-did-move")&&!t.classList.contains(B("continuation"))):!t.parentElement||e(t.parentElement)},F=function e(t){return!!t.hasAttribute("data-ignore-overflow")||!!t.parentElement&&e(t.parentElement)},R=function(e){if(p.pop(),p.length<1)throw Error("Bindery: Attempting to move the top-level element is not allowed");for(var t=e,n=[];p.length>1&&!I(m());)t=p.pop(),n.unshift(t);t.setAttribute("data-bindery-did-move",!0);var r=t.parentNode;r.removeChild(t),p.length>1&&""===m().textContent.trim()&&(r.appendChild(t),t=p.pop(),n.unshift(t),t.parentNode.removeChild(t)),h.pageInProgress.isEmpty||(h.pageInProgress.hasOverflowed()&&(h.pageInProgress.suppressErrors=!0),x()),m().appendChild(t),n.forEach(function(e){p.push(e)}),p.push(e)},j=function(e,t,n){m().appendChild(e),h.pageInProgress.hasOverflowed()?(e.parentNode.removeChild(e),n()):u.throttle(t)},H=function e(t,n,r){var i=t.nodeValue;if(m().appendChild(t),h.pageInProgress.hasOverflowed())if(m().hasAttribute("data-ignore-overflow"))u.throttle(n);else{var o=0;!function s(){if(t.nodeValue=i.substr(0,o),h.pageInProgress.hasOverflowed()){for(" "===i.charAt(o)&&(o-=1);" "!==i.charAt(o)&&o>0;)o-=1;if(o<1)return t.nodeValue=i,t.parentNode.removeChild(t),void r();var a=i.substr(0,o),l=i.substr(o);t.nodeValue=a,x();var c=document.createTextNode(l);e(c,n,r)}else if(o>i.length-1)u.throttle(n);else{for(o+=1;" "!==i.charAt(o)&&o<i.length;)o+=1;u.throttle(s)}}()}else u.throttle(n)},G=function(e,t,n){var r=function(){m().appendChild(t),F(m())||(h.pageInProgress.suppressErrors=!0,x()),u.throttle(n)};if(I(e)&&!F(e)){H(t,n,function(){p.length>1?(R(e),u.throttle(function(){return H(t,n,r)})):r()})}else{j(t,n,function(){F(m())||R(e),u.throttle(function(){return j(t,n,r)})})}},D=function e(t,n){h.pageInProgress.hasOverflowed()&&(F(m())||(h.pageInProgress.suppressErrors=!0,x()));var r=O(t);m().appendChild(r),p.push(r);var i=[].concat(z(r.childNodes));r.innerHTML="",h.pageInProgress.hasOverflowed()&&(F(m())||R(r));var o=0;!function t(){if(!(o<i.length)){var s=p.pop();return A(s),void n()}var a=i[o];if(o+=1,a.nodeType===Node.TEXT_NODE)G(r,a,t);else if(a.nodeType===Node.ELEMENT_NODE&&"SCRIPT"!==a.tagName)if("IMG"!==a.tagName||a.naturalWidth)u.throttle(function(){e(a,t)});else{var c=performance.now();te(a,function(){var n=performance.now()-c;l+=n,e(a,t)})}else t()}()};f=function(){i(h)},g=function(){if(document.body.removeChild(d),h.pages=X(h.pages,w),Q(h.pages),h.setCompleted(),M(),!s){var e=window.performance.now()-a,t=e-l;console.log("📖 Book ready in "+(e/1e3).toFixed(2)+"s (Layout: "+(t/1e3).toFixed(2)+"s, Waiting for images: "+(l/1e3).toFixed(2)+"s)")}r(h)},y(),t.style.margin=0,t.style.padding=0,x(),requestAnimationFrame(function(){D(t,g)})},re={width:"8.5in",height:"11in"},ie={width:"210mm",height:"297mm"},oe={bleed:"12pt",size:{width:"4in",height:"6in"},margin:{inner:"24pt",outer:"24pt",bottom:"40pt",top:"48pt"}},se=!!window.chrome&&!!window.chrome.webstore,ae=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};S(this,e),this.setSize(t.size||oe.size),this.setMargin(t.margin||oe.margin),this.setBleed(t.bleed||oe.bleed),this.printTwoUp=!1,this.sheetSizeMode=se?"size_page":"size_page_marks"}return C(e,[{key:"setSize",value:function(e){F(e),this.size=e}},{key:"setMargin",value:function(e){F(e),this.margin=e}},{key:"setBleed",value:function(e){this.bleed=e}},{key:"setSheetSizeMode",value:function(e){this.sheetSizeMode=e}},{key:"setPrintTwoUp",value:function(e){this.printTwoUp=e}},{key:"isSizeValid",value:function(){return this.updateStylesheet(),V.isSizeValid()}},{key:"spreadSizeStyle",value:function(){var e=R(this.size.width);return{height:this.size.height,width:""+2*e.val+e.unit}}},{key:"updateStylesheet",value:function(){var e=void 0,t=document.querySelector("#binderyPageSetup");t?e=t:(e=document.createElement("style")).id="binderyPageSetup";var n=R(this.size.width);e.innerHTML="\n@page { size: "+this.sheetSize.width+" "+this.sheetSize.height+"; }\n"+B(".print-page")+" { width: "+this.sheetSize.width+"; height: "+this.sheetSize.height+";}\n\n"+B(".show-crop")+" "+B(".print-page")+" "+B(".spread-wrapper")+",\n"+B(".show-bleed-marks")+" "+B(".print-page")+" "+B(".spread-wrapper")+" {\n  margin: calc("+this.bleed+" + 12pt) auto;\n}\n"+B(".page-size")+" {\n  height: "+this.size.height+";\n  width: "+this.size.width+";\n}\n"+B(".page-size-rotated")+" {\n  height: "+this.size.width+";\n  width: "+this.size.height+";\n}\n"+B(".spread-size")+" {\n  height: "+this.size.height+";\n  width: "+2*n.val+n.unit+";\n}\n"+B(".spread-size-rotated")+" {\n  height: "+2*n.val+n.unit+";\n  width: "+this.size.height+";\n}\n"+B(".flowbox")+",\n"+B(".footer")+" {\n  margin-left: "+this.margin.inner+";\n  margin-right: "+this.margin.outer+";\n}\n"+B(".left")+" "+B(".flowbox")+",\n"+B(".left")+" "+B(".footer")+" {\n  margin-left: "+this.margin.outer+";\n  margin-right: "+this.margin.inner+";\n}\n\n"+B(".left")+" "+B(".running-header")+" {\n  left: "+this.margin.outer+";\n}\n"+B(".right")+" "+B(".running-header")+" {\n  right: "+this.margin.outer+";\n}\n\n"+B(".flowbox")+" { margin-top: "+this.margin.top+"; }\n"+B(".footer")+"{ margin-bottom: "+this.margin.bottom+"; }\n\n"+B(".bleed-left")+",\n"+B(".bleed-right")+",\n"+B(".crop-left")+",\n"+B(".crop-right")+",\n"+B(".crop-fold")+" {\n  top: calc( -12pt - "+this.bleed+" );\n  bottom: calc( -12pt - "+this.bleed+" );\n}\n\n"+B(".bleed-top")+",\n"+B(".bleed-bottom")+",\n"+B(".crop-top")+",\n"+B(".crop-bottom")+" {\n  left: calc( -12pt - "+this.bleed+" );\n  right: calc( -12pt - "+this.bleed+" );\n}\n"+B(".bleed-left")+"   { left: -"+this.bleed+"; }\n"+B(".bleed-right")+"  { right: -"+this.bleed+"; }\n"+B(".bleed-top")+"    { top: -"+this.bleed+"; }\n"+B(".bleed-bottom")+" { bottom: -"+this.bleed+"; }\n\n"+B(".background")+" {\n  top: -"+this.bleed+";\n  bottom: -"+this.bleed+";\n  left: -"+this.bleed+";\n  right: -"+this.bleed+";\n}\n\n"+B(".spread")+B(".right")+" > "+B(".background")+" {\n  left: calc(-100% - "+this.bleed+");\n}\n"+B(".spread")+B(".left")+" > "+B(".background")+" {\n  right: calc(-100% - "+this.bleed+");\n}\n    ",document.head.appendChild(e)}},{key:"displaySize",get:function(){return{width:this.printTwoUp?this.spreadSizeStyle().width:this.size.width,height:this.size.height,bleed:this.bleed}}},{key:"sheetSize",get:function(){var e=this.printTwoUp?this.spreadSizeStyle().width:this.size.width,t=this.size.height,n=this.bleed;switch(this.sheetSizeMode){case"size_page":return{width:e,height:t};case"size_page_bleed":return{width:"calc("+e+" + "+n+" + "+n+")",height:"calc("+t+" + "+n+" + "+n+")"};case"size_page_marks":return{width:"calc("+e+" + "+n+" + "+n+" + 24pt)",height:"calc("+t+" + "+n+" + "+n+" + 24pt)"};case"size_letter_l":return{width:re.height,height:re.width};case"size_letter_p":return re;case"size_a4_p":return ie;case"size_a4_l":return{width:ie.height,height:ie.width}}return{width:e,height:t}}}]),e}(),le=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return k.apply(void 0,[B(".title")].concat(t))},ue=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return k.apply(void 0,[B(".row")].concat(t))},ce=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return k.apply(void 0,["button."+B("btn")].concat(t))},de=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return k.apply(void 0,["button."+B("btn")+"."+B("btn-main")].concat(t))},pe=function(){for(var e=k(B(".select-val"),"Value"),t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=k.apply(void 0,["select."+B("select")].concat(n)),o=function(){e.textContent=i.options[i.selectedIndex].text};return i.addEventListener("change",o),o(),k(B(".select-wrap"),e,i)},he=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return k.apply(void 0,["option"].concat(t))},fe=function(e,t,n){var r="."+B("viewmode")+"."+B(e);return k(r,{onclick:t},k(B(".icon")))},ge=!!window.chrome&&!!window.chrome.webstore,me=function e(t){var n=this;S(this,e),this.binder=t.binder;var r=t.viewer,i=de({onclick:function(){r.setPrint(),setTimeout(window.print,10)}},"Print"),o=(ce({onclick:function(){n.binder.autorun?window.history.back():n.binder.cancel()}},"Done"),ge?[he({value:"size_page",selected:!0},"Auto"),he({value:"size_page_bleed"},"Auto + Bleed"),he({value:"size_page_marks"},"Auto + Marks"),he({value:"size_letter_p"},"Letter Portrait"),he({value:"size_letter_l"},"Letter Landscape"),he({value:"size_a4_p"},"A4 Portrait"),he({value:"size_a4_l"},"A4 Landscape")]:[he({value:"size_letter_p",selected:!0},"Default Page Size *"),he({disabled:!0},"Only Chrome supports custom page sizes. Set in your browser's print dialog instead.")]),s=function(){if(ge){var e=n.binder.pageSetup.displaySize,t=e.width+" × "+e.height;o[0].textContent=""+t,o[1].textContent=t+" + Bleed",o[2].textContent=t+" + Marks"}};s();var a=pe.apply(void 0,[{onchange:function(e){var t=e.target.value;r.setSheetSize(t),"size_page"===t||"size_page_bleed"===t?(c.disabled=!0,c.classList.add(B("hidden-select"))):(c.classList.remove(B("hidden-select")),c.disabled=!1),n.binder.pageSetup.updateStylesheet()}}].concat(o)),l=pe({onchange:function(e){r.setPrintArrange(e.target.value),s()}},he({value:"arrange_one",selected:!0},"1 Page / Sheet"),he({value:"arrange_two"},"1 Spread / Sheet"),he({value:"arrange_booklet"},"Booklet Sheets")),u=ue(l),c=pe({onchange:function(e){switch(e.target.value){case"marks_none":r.isShowingCropMarks=!1,r.isShowingBleedMarks=!1;break;case"marks_crop":r.isShowingCropMarks=!0,r.isShowingBleedMarks=!1;break;case"marks_bleed":r.isShowingCropMarks=!1,r.isShowingBleedMarks=!0;break;case"marks_both":r.isShowingCropMarks=!0,r.isShowingBleedMarks=!0}}},he({value:"marks_none"},"No Marks"),he({value:"marks_crop",selected:!0},"Crop Marks"),he({value:"marks_bleed"},"Bleed Marks"),he({value:"marks_both"},"Crop and Bleed"));ge&&c.classList.add(B("hidden-select"));var d=ue(c),p=ue(a),h=k("div",{style:{display:"none",color:"#e2b200"}},"Too Small"),f=function(){n.binder.makeBook(function(){})},g=[fe("grid",r.setGrid),fe("flip",r.setFlip),fe("print",r.setPrint)],m=k.apply(void 0,[B(".viewswitcher")].concat(g)),v=k("span","Loading"),y=void 0,w=ce("→",{style:{display:"none"},onclick:function(){return window.binderyDebug.step()}}),b=ce("❙❙",{onclick:function(){window.binderyDebug.pause(),E.classList.add(B("paused")),b.style.display="none",y.style.display="",w.style.display=""}});y=ce("▶️",{style:{display:"none"},onclick:function(){window.binderyDebug.resume(),E.classList.remove(B("paused")),y.style.display="none",b.style.display="",w.style.display="none"}});var x=ce("Finish",{onclick:function(){E.classList.remove(B("paused")),window.binderyDebug.finish()}}),C=k(B(".debug-controls"),b,y,w,x),_=k("a",{onclick:function(){n.binder.debug=!1,f()}},"Refresh");_.classList.add(B("refresh"));var L=k("a","🐞",{onclick:function(){y.style.display="none",w.style.display="none",b.style.display="",n.binder.debug=!0,f()}}),E=k(B(".spinner")),z=le(E,v,k(B(".refresh-btns"),_,L));this.setInProgress=function(){v.textContent="Paginating",h.style.display="none"},this.updateProgress=function(e){v.textContent=e+" Pages"},this.setDone=function(){v.textContent=r.book.pages.length+" Pages",h.style.display="none"},this.setInvalid=function(){h.style.display=""},i.classList.add(B("btn-print"));var P=ue(u,p,d);P.classList.add(B("print-options")),this.element=k(B(".controls"),m,P,z,C,i)},ve=function(e,t){return k(B(".error"),k(B(".error-title"),e),k(B(".error-text"),t),k(B(".error-footer"),"Bindery [AIV]{version}[/AIV]"))},ye=function(e){for(;e.length%4!=0;){var t=new V;t.element.style.visibility="hidden",e.push(t)}for(var n=[],r=e.length,i=0;i<r/2;i+=2)n.push(e[r-1-i]),n.push(e[i]),n.push(e[i+1]),n.push(e[r-2-i]);return n},we=function(e){if(e.length%2!=0){var t=new V;e.push(t)}var n=new V,r=new V;return n.element.style.visibility="hidden",r.element.style.visibility="hidden",e.unshift(n),e.push(r),e},be=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return k.apply(void 0,[B(".spread-wrapper")+B(".spread-size")].concat(t))},ke=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return k.apply(void 0,[B(".spread-wrapper")+B(".page-size")].concat(t))},xe=function(e,t){var n=document.createDocumentFragment();if(t)for(var r=0;r<e.length;r+=2){var i=be(e[r].element,e[r+1].element);n.appendChild(i)}else e.forEach(function(e){var t=ke(e.element);n.appendChild(t)});return n},Se=function(){return[k(B(".bleed-top")),k(B(".bleed-bottom")),k(B(".bleed-left")),k(B(".bleed-right"))]},Ce=function(){return[k(B(".crop-top")),k(B(".crop-bottom")),k(B(".crop-left")),k(B(".crop-right"))]},_e=function(){return k.apply(void 0,[B(".print-mark-wrap")].concat(z(Ce()),z(Se())))},Le=function(){return k.apply(void 0,[B(".print-mark-wrap"),k(B(".crop-fold"))].concat(z(Ce()),z(Se())))},Ee=function(e,t){var n=e%4==0,r=parseInt((e+1)/4,10)+1;return k(B(".print-meta"),"Sheet "+r+" of "+t/4+": "+(n?"Outside":"Inside"))},ze=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return k.apply(void 0,[B(".spread-wrapper")+B(".spread-size")].concat(t))},Pe=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return k.apply(void 0,[B(".spread-wrapper")+B(".page-size")].concat(t))},Oe=function(e,t,n,r){var i=document.createDocumentFragment(),o=t?Le:_e,s=t?ze:Pe,a=function(){return k(B(".print-page"),s.apply(void 0,arguments))};if(t)for(var l=0;l<e.length;l+=2){var u=o();if(r){var c=Ee(l,e.length);u.appendChild(c)}var d=a(e[l].element,e[l+1].element,u);i.appendChild(d)}else e.forEach(function(e){var t=a(e.element,o());i.appendChild(t)});return i},Ae=function(e,t){var n=document.createDocumentFragment(),r=k(B(".spread-size")+B(".flip-sizer")),i=k(B(".spread-size")+B(".flap-holder"));r.appendChild(i),n.appendChild(r);var o=[],s=-1,a=4;e.length*a>60&&(a=60/e.length),i.style.width=e.length*a+"px";for(var l=function(e){var t=e;t===s&&(t+=1),s=t;var n=4;o.length*n>200&&(n=200/o.length),o.forEach(function(e,r,i){var o=(i.length-Math.abs(r-t+.5))*n;e.style.transform="translate3d("+(r<t?4:0)+"px,0,"+o+"px) rotateY("+(r<t?-180:0)+"deg)"})},u=0,c=1;c<e.length-1;c+=t?2:1)!function(n){var r=u+=1,s=k(B(".page3d")+B(".page-size"),{onclick:function(){l(r-1)}}),c=e[n].element,d=void 0;c.classList.add(B("page3d-front")),s.appendChild(c),t?(s.classList.add(B("doubleSided")),(d=e[n+1].element).classList.add(B("page3d-back")),s.appendChild(d)):(d=k(B(".page")+B(".page3d-back")),s.appendChild(d)),s.style.left=n*a+"px",o.push(s),i.appendChild(s)}(c);return l(0),n},Be="grid",Te="arrange_one",Me=function(){function e(t){var n=t.bindery;S(this,e),this.book=null,this.pageSetup=n.pageSetup,this.zoomBox=k(B(".zoom-wrap")),this.element=k(B(".root"),this.zoomBox),this.doubleSided=!0,this.printArrange=Te,this.isShowingCropMarks=!0,this.isShowingBleedMarks=!1,this.mode=Be,this.element.setAttribute("bindery-view-mode",this.mode),this.currentLeaf=0,this.listenForPrint(),this.listenForResize(),this.setGrid=this.setGrid.bind(this),this.setOutline=this.setOutline.bind(this),this.setPrint=this.setPrint.bind(this),this.setFlip=this.setFlip.bind(this),this.controls=new me({binder:n,viewer:this}),this.element.classList.add(B("in-progress")),this.element.appendChild(this.controls.element),document.body.appendChild(this.element)}return C(e,[{key:"listenForPrint",value:function(){var e=this;window.matchMedia&&window.matchMedia("print").addListener(function(t){t.matches&&e.setPrint()})}},{key:"listenForResize",value:function(){var e=this;window.addEventListener("resize",function(){e.throttleResize||(e.updateZoom(),e.throttleResize=setTimeout(function(){e.throttleResize=null},20))})}},{key:"setSheetSize",value:function(e){var t=this;this.pageSetup.setSheetSizeMode(e),this.pageSetup.updateStylesheet(),"print"!==this.mode&&this.setPrint(),this.updateZoom(),setTimeout(function(){t.updateZoom()},300)}},{key:"setPrintArrange",value:function(e){e!==this.printArrange&&(this.printArrange=e,this.pageSetup.setPrintTwoUp(this.isTwoUp),this.pageSetup.updateStylesheet(),"print"===this.mode?this.render():this.setPrint())}},{key:"displayError",value:function(e,t){this.element.parentNode||document.body.appendChild(this.element),this.error||(this.error=ve(e,t),this.element.appendChild(this.error))}},{key:"clear",value:function(){this.book=null,this.lastSpreadInProgress=null,this.zoomBox.innerHTML=""}},{key:"cancel",value:function(){this.element.parentNode&&this.element.parentNode.removeChild(this.element)}},{key:"toggleGuides",value:function(){this.element.classList.toggle(B("show-guides"))}},{key:"toggleBleed",value:function(){this.element.classList.add(B("show-bleed"))}},{key:"toggleDouble",value:function(){this.doubleSided=!this.doubleSided,this.render()}},{key:"setMode",value:function(e){switch(e){case"grid":case"default":this.mode=Be;break;case"interactive":case"flip":this.mode="interactive";break;case"print":case"sheet":this.mode="print";break;case"outline":case"outlines":this.mode="outline";break;default:console.error('Bindery: Unknown view mode "'+e+'"')}}},{key:"setGrid",value:function(){this.mode!==Be&&("outline"===this.mode?(this.mode=Be,this.updateGuides()):(this.mode=Be,this.render()))}},{key:"setOutline",value:function(){"outline"!==this.mode&&(this.mode===Be?(this.mode="outline",this.updateGuides()):(this.mode="outline",this.render()))}},{key:"setPrint",value:function(){"print"!==this.mode&&(this.mode="print",this.render())}},{key:"setFlip",value:function(){this.mode="interactive",this.render()}},{key:"render",value:function(){if(this.book){var e=document.body;this.element.parentNode||e.appendChild(this.element),this.flaps=[],e.classList.add(B("viewing")),this.element.setAttribute("bindery-view-mode",this.mode);var t=e.scrollHeight-e.offsetHeight,n=e.scrollTop/t;this.mode===Be?this.renderGrid():"outline"===this.mode?this.renderGrid():"interactive"===this.mode?this.renderInteractive():"print"===this.mode?this.renderPrint():this.renderGrid(),e.scrollTop=t*n,this.updateZoom()}}},{key:"renderProgress",value:function(){var e=this,t=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return k.apply(void 0,[B(".spread-wrapper")+B(".spread-size")].concat(t))};this.book.pages.forEach(function(n,r){if(!e.zoomBox.contains(n.element)||n.element.parentNode===e.zoomBox)if(e.lastSpreadInProgress&&e.lastSpreadInProgress.children.length<2)e.lastSpreadInProgress.appendChild(n.element);else{if(0===r){var i=new V;i.element.style.visibility="hidden",e.lastSpreadInProgress=t(i.element,n.element)}else e.lastSpreadInProgress=t(n.element);e.zoomBox.appendChild(e.lastSpreadInProgress)}}),this.book.pageInProgress&&this.zoomBox.appendChild(this.book.pageInProgress.element),this.updateZoom()}},{key:"updateZoom",value:function(){if(this.zoomBox.firstElementChild){var e=document.body.scrollTop/document.body.scrollHeight,t=this.zoomBox.getBoundingClientRect(),n=this.zoomBox.firstElementChild.getBoundingClientRect().width,r=Math.min(1,t.width/n);this.zoomBox.style.transform="scale("+r+")",document.body.scrollTop=document.body.scrollHeight*e}}},{key:"updateGuides",value:function(){this.element.setAttribute("bindery-view-mode",this.mode),"outline"===this.mode?(this.element.classList.add(B("show-bleed")),this.element.classList.add(B("show-guides"))):(this.element.classList.remove(B("show-bleed")),this.element.classList.remove(B("show-guides")))}},{key:"renderPrint",value:function(){this.element.classList.add(B("show-bleed")),this.element.classList.remove(B("show-guides")),this.zoomBox.innerHTML="";var e="arrange_booklet"===this.printArrange,t=(this.orientation,this.book.pages.slice());"arrange_two"===this.printArrange?t=we(t):e&&(t=ye(t));var n=Oe(t,this.isTwoUp,0,e);this.zoomBox.appendChild(n)}},{key:"renderGrid",value:function(){this.updateGuides(),this.zoomBox.innerHTML="";var e=this.book.pages.slice();this.doubleSided&&(e=we(e));var t=xe(e,this.doubleSided);this.zoomBox.appendChild(t)}},{key:"renderInteractive",value:function(){this.zoomBox.innerHTML="",this.flaps=[],this.element.classList.remove(B("show-bleed")),this.element.classList.remove(B("show-guides"));var e=we(this.book.pages.slice()),t=Ae(e,this.doubleSided);this.zoomBox.appendChild(t)}},{key:"isTwoUp",get:function(){return this.printArrange!==Te}},{key:"isShowingCropMarks",get:function(){return this.element.classList.contains(B("show-crop"))},set:function(e){e?(this.element.classList.add(B("show-crop")),this.setPrint()):this.element.classList.remove(B("show-crop"))}},{key:"isShowingBleedMarks",get:function(){return this.element.classList.contains(B("show-bleed-marks"))},set:function(e){e?(this.element.classList.add(B("show-bleed-marks")),this.setPrint()):this.element.classList.remove(B("show-bleed-marks"))}}]),e}(),Ne=function(e){function t(e){S(this,t),e.toNext=e.toNext||"split-to-next",e.fromPrevious=e.fromPrevious||"split-from-previous";var n=E(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return G.validate(e,{name:"Split",selector:G.string,toNext:G.string,fromPrevious:G.string}),n}return L(t,U),C(t,[{key:"customContinuesClass",get:function(){return this.toNext}},{key:"customContinuationClass",get:function(){return this.fromPrevious}}]),t}(),Ie=function(e){function t(e){S(this,t);var n=E(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.selector="*",n.counterValue=0,G.validate(e,{name:"Counter",replaceEl:G.string,resetEl:G.string,incrementEl:G.string,replace:G.func}),n}return L(t,U),C(t,[{key:"layoutStart",value:function(){this.counterValue=0}},{key:"beforeAdd",value:function(e){return e.matches(this.incrementEl)&&(this.counterValue+=1),e.matches(this.resetEl)&&(this.counterValue=0),e.matches(this.replaceEl)?this.createReplacement(e):e}},{key:"createReplacement",value:function(e){return this.replace(e,this.counterValue)}},{key:"replace",value:function(e,t){return e.textContent=t,e}}]),t}(),Fe=function(e){function t(e){S(this,t);var n=E(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.name="Replace",n}return L(t,U),C(t,[{key:"afterAdd",value:function(e,t,n,r,i){var o=e.parentNode;if(!o)throw Error("Bindery: Rule assumes element has been added but it has no parent.",e);var s=e.cloneNode(!0),a=this.createReplacement(t,s);return o.replaceChild(a,e),t.pageInProgress.hasOverflowed()?(o.replaceChild(e,a),i(e)):a}},{key:"createReplacement",value:function(e,t){return this.replace(t)}},{key:"replace",value:function(e){return e.insertAdjacentHTML("beforeEnd",'<sup class="bindery-sup">Default Replacement</sup>'),e}}]),t}(),Re=function(e){function t(e){S(this,t);var n=E(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return G.validate(e,{name:"Footnote",selector:G.string,replace:G.func,render:G.func}),n}return L(t,Fe),C(t,[{key:"afterAdd",value:function(e,n,r,i,o){var s=n.pageInProgress.footer.children.length+1,a=k(".footnote"),l=this.render(e,s);return l instanceof HTMLElement?a.appendChild(l):a.innerHTML=l,n.pageInProgress.footer.appendChild(a),_(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"afterAdd",this).call(this,e,n,r,i,function(e){return n.pageInProgress.footer.removeChild(a),o(e)})}},{key:"createReplacement",value:function(e,t){var n=e.pageInProgress.footer.children.length;return this.replace(t,n)}},{key:"replace",value:function(e,t){return e.insertAdjacentHTML("beforeEnd",'<sup class="bindery-sup">'+t+"</sup>"),e}},{key:"render",value:function(e,t){return"<sup>"+t+"</sup> Default footnote (<a href='/bindery/docs/#footnote'>Learn how to change it</a>)"}}]),t}(),je=function(e){function t(e){S(this,t);var n=E(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return G.validate(e,{name:"PageReference",selector:G.string,replace:G.func,createTest:G.func}),n}return L(t,Fe),C(t,[{key:"afterAdd",value:function(e,t){var n=this,r=this.createTest(e);if(r){var i=e.parentNode,o=e.cloneNode(!0),s=t.pagesForTest(r),a=M(s),l=this.replace(o,a||"###");return l.classList.add(B("placeholder-pulse")),i.replaceChild(l,e),t.onComplete(function(){var i=l.parentNode,o=e.cloneNode(!0),s=t.pagesForTest(r),a=M(s),u=n.replace(o,a);i.replaceChild(u,l)}),l}return e}},{key:"createTest",value:function(e){var t=e.getAttribute("href");return t?(t=t.replace("#",""),t='[id="'+t+'"]',function(e){return e.querySelector(t)}):null}},{key:"replace",value:function(e,t){return e.insertAdjacentHTML("beforeend",", <span>"+t+"</span>"),e}}]),t}(),He=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};S(this,t);var n=E(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return G.validate(e,{name:"RunningHeader",render:G.func}),n}return L(t,U),C(t,[{key:"eachPage",value:function(e){if(!e.runningHeader){var t=k(B(".running-header"));e.element.appendChild(t),e.runningHeader=t}e.runningHeader.innerHTML=this.render(e)}},{key:"render",value:function(e){return e.number}}]),t}(),Ge={Rule:U,Split:function(e){return new Ne(e)},Counter:function(e){return new Ie(e)},FullBleedPage:function(e){return new W(e)},Footnote:function(e){return new Re(e)},RunningHeader:function(e){return new He(e)},Replace:function(e){return new Fe(e)},FullBleedSpread:function(e){return new Z(e)},PageBreak:function(e){return new J(e)},PageReference:function(e){return new je(e)},createRule:function(e){return new U(e)}};!function(e){if(e&&"undefined"!=typeof window){var t=document.createElement("style");t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t)}}("@charset \"UTF-8\";@media screen{.📖-page{background:#fff;outline:1px solid rgba(0,0,0,.1);box-shadow:0 1px 3px rgba(0,0,0,.2);overflow:hidden}.📖-show-bleed .📖-page{box-shadow:none;outline:none;overflow:visible}.📖-page:after{content:\"\";position:absolute;top:0;left:0;right:0;bottom:0;pointer-events:none;z-index:3}}li.📖-continuation,p.📖-continuation{text-indent:unset!important}li.📖-continuation{list-style:none!important}.📖-out-of-flow{display:none}.📖-page{width:200px;height:300px;position:relative;display:flex;flex-direction:column;flex-wrap:nowrap;margin:auto}.📖-flowbox{position:relative;margin:60px 40px;margin-bottom:0;flex:1 1 auto;min-height:0}.📖-content{padding:.1px;position:relative}.📖-footer{margin:60px 40px;margin-top:8pt;flex:0 1 auto;z-index:1}.📖-background{position:absolute;z-index:0;overflow:hidden}.📖-left>.📖-background{right:0}.📖-right>.📖-background{left:0}.📖-sup{font-size:.667em}.📖-footer,.📖-running-header{font-size:10pt}.📖-running-header{position:absolute;text-align:center;top:.25in}.📖-left .📖-running-header{left:18pt;text-align:left}.📖-right .📖-running-header{right:18pt;text-align:right}.📖-left .📖-rotate-container.📖-rotate-outward,.📖-left .📖-rotate-container.📖-rotate-spread-clockwise,.📖-right .📖-rotate-container.📖-rotate-inward,.📖-rotate-container.📖-rotate-clockwise{transform:rotate(90deg) translate3d(0,-100%,0);transform-origin:top left}.📖-left .📖-rotate-container.📖-rotate-inward,.📖-left .📖-rotate-container.📖-rotate-spread-counterclockwise,.📖-right .📖-rotate-container.📖-rotate-outward,.📖-rotate-container.📖-rotate-counterclockwise{transform:rotate(-90deg) translate3d(-100%,0,0);transform-origin:top left}.📖-rotate-container{position:absolute}.📖-left .📖-rotate-container.📖-rotate-clockwise .📖-background{bottom:0}.📖-left .📖-rotate-container.📖-rotate-counterclockwise .📖-background,.📖-right .📖-rotate-container.📖-rotate-clockwise .📖-background{top:0}.📖-right .📖-rotate-container.📖-rotate-counterclockwise .📖-background,.📖-rotate-container.📖-rotate-inward .📖-background{bottom:0}.📖-rotate-container.📖-rotate-outward .📖-background{top:0}.📖-right .📖-rotate-container.📖-rotate-spread-clockwise{transform:rotate(90deg) translate3d(0,-50%,0);transform-origin:top left}.📖-right .📖-rotate-container.📖-rotate-spread-counterclockwise{transform:rotate(-90deg) translate3d(-100%,-50%,0);transform-origin:top left}.📖-print-mark-wrap{display:none;position:absolute;pointer-events:none;top:0;bottom:0;left:0;right:0;z-index:3}.📖-show-bleed-marks .📖-print-mark-wrap,.📖-show-bleed-marks .📖-print-mark-wrap>[class*=bleed],.📖-show-crop .📖-print-mark-wrap,.📖-show-crop .📖-print-mark-wrap>[class*=crop]{display:block}.📖-print-mark-wrap>div{display:none;position:absolute;overflow:hidden}.📖-print-mark-wrap>div:after,.📖-print-mark-wrap>div:before{content:\"\";display:block;position:absolute}.📖-print-mark-wrap>div:before{top:0;left:0}.📖-print-mark-wrap>div:after{bottom:0;right:0}.📖-bleed-left,.📖-bleed-right,.📖-crop-fold,.📖-crop-left,.📖-crop-right{width:1px;margin:auto}.📖-bleed-left:after,.📖-bleed-left:before,.📖-bleed-right:after,.📖-bleed-right:before,.📖-crop-fold:after,.📖-crop-fold:before,.📖-crop-left:after,.📖-crop-left:before,.📖-crop-right:after,.📖-crop-right:before{width:1px;height:12pt;background-image:linear-gradient(90deg,#000 0,#000 51%,transparent 0);background-size:1px 100%}.📖-bleed-bottom,.📖-bleed-top,.📖-crop-bottom,.📖-crop-top{height:1px}.📖-bleed-bottom:after,.📖-bleed-bottom:before,.📖-bleed-top:after,.📖-bleed-top:before,.📖-crop-bottom:after,.📖-crop-bottom:before,.📖-crop-top:after,.📖-crop-top:before{width:12pt;height:1px;background-image:linear-gradient(180deg,#000 0,#000 51%,transparent 0);background-size:100% 1px}.📖-crop-fold{right:0;left:0}.📖-crop-left{left:0}.📖-crop-right{right:0}.📖-crop-top{top:0}.📖-crop-bottom{bottom:0}.📖-print-meta{padding:12pt;text-align:center;font-family:-apple-system,BlinkMacSystemFont,Roboto,sans-serif;font-size:8pt;display:block!important;position:absolute;bottom:-60pt;left:0;right:0}@media screen{.📖-viewing{background:#f4f4f4!important}.📖-root{transition:opacity .2s;opacity:1;padding:10px;position:relative;padding-top:80px;animation:a .3s;min-height:90vh}.📖-measure-area,.📖-root{background:#f4f4f4;z-index:2}.📖-measure-area{position:fixed;padding:50px 20px;visibility:hidden;left:0;right:0;bottom:0}.📖-measure-area .📖-page{margin:0 auto 50px}.📖-is-overflowing{border-bottom:1px solid #f0f}.📖-print-page{margin:0 auto}.📖-error{font:16px/1.4 -apple-system,BlinkMacSystemFont,Roboto,sans-serif;padding:15vh 15vw;z-index:3;position:fixed;top:0;left:0;right:0;bottom:0;background:hsla(0,0%,96%,.7)}.📖-error-title{font-size:1.5em;margin-bottom:16px}.📖-error-text{margin-bottom:16px;white-space:pre-line}.📖-error-footer{opacity:.5;font-size:.66em;text-transform:uppercase;letter-spacing:.02em}.📖-show-bleed .📖-print-page{background:#fff;outline:1px solid rgba(0,0,0,.1);box-shadow:0 1px 3px rgba(0,0,0,.2);margin:20px auto}.📖-placeholder-pulse{animation:b 1s infinite}}@keyframes a{0%{opacity:0}to{opacity:1}}@keyframes b{0%{opacity:.2}50%{opacity:.5}to{opacity:.2}}@page{margin:0}@media print{.📖-root *{-webkit-print-color-adjust:exact;color-adjust:exact}.📖-controls,.📖-viewing>:not(.📖-root){display:none!important}.📖-print-page{padding:1px;margin:0 auto}.📖-zoom-wrap[style]{transform:none!important}}body.📖-viewing{margin:0}.📖-zoom-wrap{transform-origin:top left;transform-style:preserve-3d;height:calc(100vh - 120px)}[bindery-view-mode=interactive] .📖-zoom-wrap{transform-origin:center left}.📖-viewing>:not(.📖-root):not(.📖-measure-area){display:none!important}.📖-print-page{page-break-after:always;position:relative;overflow:hidden;display:flex;align-items:center;justify-content:center;transition:all .2s}.📖-spread-wrapper{position:relative;display:flex;width:800px;margin:0 auto 50px}.📖-print-page .📖-spread-wrapper{margin:0 auto}.📖-flap-holder{perspective:5000px;position:absolute;top:0;right:0;left:0;bottom:0;margin:auto;transform-style:preserve-3d}.📖-flip-sizer{position:relative;margin:auto;padding:0 20px;box-sizing:content-box}.📖-page3d{margin:auto;width:400px;height:600px;transform:rotateY(0);transform-style:preserve-3d;transform-origin:left;transition:transform .5s,box-shadow .1s;position:absolute;left:0;right:0;top:0;bottom:0}.📖-page3d:hover{box-shadow:2px 0 4px rgba(0,0,0,.2)}.📖-page3d.flipped{transform:rotateY(-180deg)}.📖-page3d .📖-page{position:absolute;backface-visibility:hidden;-webkit-backface-visibility:hidden;box-shadow:none}.📖-page3d .📖-page3d-front{transform:rotateY(0)}.📖-page3d .📖-page3d-back{transform:rotateY(-180deg)}@media screen{.📖-viewing .📖-controls{display:flex!important}}.📖-controls{font:14px/1.4 -apple-system,BlinkMacSystemFont,Roboto,sans-serif;display:none;flex-direction:row;align-items:start;position:fixed;top:0;left:0;right:0;z-index:3;margin:auto;color:#000;padding:10px;overflow:visible;-webkit-font-smoothing:antialiased}.📖-controls *{font:inherit;color:inherit;margin:0;padding:0;box-sizing:border-box}.📖-controls a{color:blue;text-decoration:none}.📖-row{position:relative;display:flex;flex-wrap:wrap;align-items:start;cursor:default;user-select:none;margin-left:8px;margin-bottom:8px}.📖-title{position:relative;display:flex;padding:8px 16px;transition:opacity .2s;display:none;white-space:nowrap;overflow:hidden;margin-right:auto;opacity:0}.📖-in-progress .📖-title{opacity:1;display:flex}.📖-print-options{opacity:1;display:none}[bindery-view-mode=print] .📖-print-options{display:flex}.📖-in-progress .📖-print-options{opacity:0;display:none}.📖-spinner{border:1px solid transparent;border-left-color:#000;width:20px;height:20px;border-radius:50%;vertical-align:middle;opacity:0;pointer-events:none;transition:all .2s;margin-right:16px}.📖-in-progress .📖-spinner{opacity:1;animation:c .6s linear infinite}.📖-debug .📖-spinner{animation:c 2s linear infinite}.📖-spinner.📖-paused{animation:none}@keyframes c{0%{transform:rotate(0)}to{transform:rotate(1turn)}}.📖-controls .📖-btn{-webkit-appearance:none;color:#000;padding:8px 16px;background:#ddd;border:0;cursor:pointer;display:inline-block;border-radius:2px;margin-right:8px;text-decoration:none}.📖-controls .📖-btn:hover{background:#eee}.📖-controls .📖-btn:active{background:#ddd}.📖-controls .📖-btn:last-child{margin-right:0}.📖-controls .📖-btn-light{background:none;border:none}.📖-controls .📖-btn-main{background:blue;border-color:blue;color:#fff}.📖-controls .📖-btn-main:hover{background:blue;opacity:.7}.📖-controls .📖-btn-main:active{background:#000;opacity:1}.📖-btn-print{margin-left:auto;transition:all .8s}.📖-in-progress .📖-btn-print{background:gray;pointer-events:none}.📖-debug .📖-btn-print{display:none}.📖-viewswitcher{opacity:1;transform:scale(1);transition:all .8s;transition-delay:.2s;user-select:none;overflow:hidden;display:flex;flex-direction:row;border-radius:2px}.📖-in-progress .📖-viewswitcher{pointer-events:none}.📖-viewmode{color:#444;cursor:pointer;padding:0 8px;border-radius:2px}.📖-viewmode:hover{background:#eee}.📖-viewmode:active{background:#ddd}.📖-viewmode .📖-icon{height:36px;width:32px;background:currentColor;margin:0 auto}.📖-in-progress .📖-viewmode .📖-icon{color:gray!important}.📖-viewmode.📖-grid .📖-icon{-webkit-mask:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='32' height='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M5.5 8.5h11v15h-11zm11 0h11v15h-11z' stroke='%23000' fill='none' fill-rule='evenodd'/%3E%3C/svg%3E\") no-repeat 50% 50%}[bindery-view-mode=grid] .📖-viewmode.📖-grid .📖-icon{-webkit-mask-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='32' height='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M5 8h11v16H5zm12 0h11v16H17z' fill-rule='evenodd'/%3E%3C/svg%3E\")}.📖-viewmode.📖-flip .📖-icon{-webkit-mask:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='32' height='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg'%3E%3Cg stroke='%23000' fill='none' fill-rule='evenodd'%3E%3Cpath d='M5.5 8.5h11v15h-11z'/%3E%3Cpath d='M27.5 23.5v-15' stroke-linecap='square'/%3E%3Cpath d='M16.5 8.5v15h.41l7.59-2.847V5.722l-7.324 2.746L17 8.5h-.5z'/%3E%3Cpath d='M27.5 23.5h-11m8-15h3' stroke-linecap='square'/%3E%3C/g%3E%3C/svg%3E\") no-repeat 50% 50%}[bindery-view-mode=interactive] .📖-viewmode.📖-flip .📖-icon{-webkit-mask-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='32' height='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M26 8h2v16h-8.152L26 21.693V8zM5 8h11v16H5V8zm12 0l8-3v16l-8 3V8z' fill-rule='evenodd'/%3E%3C/svg%3E\")}.📖-viewmode.📖-print .📖-icon{background:svg-inline(\"_assets/icon-sheet.svg\");-webkit-mask:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='32' height='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cpath stroke='%23000' d='M9.5 5.5h13v6h-13zm13 17H26a1.5 1.5 0 0 0 1.5-1.5v-8a1.5 1.5 0 0 0-1.5-1.5H6A1.5 1.5 0 0 0 4.5 13v8A1.5 1.5 0 0 0 6 22.5h3.5v-5h13v5z'/%3E%3Ccircle fill='%23000' cx='25' cy='14' r='1'/%3E%3Cpath stroke='%23000' d='M9.5 17.5h13v8h-13z'/%3E%3C/g%3E%3C/svg%3E\") no-repeat 50% 50%}[bindery-view-mode=print] .📖-viewmode.📖-print .📖-icon{-webkit-mask-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='32' height='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill-rule='evenodd'%3E%3Cpath d='M9 5h14v5H9zm15 18v-5H8v5H6a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2zm1-8a1 1 0 1 0 0-2 1 1 0 0 0 0 2z'/%3E%3Cpath d='M9 19h14v8H9z'/%3E%3C/g%3E%3C/svg%3E\")}[bindery-view-mode=grid] .📖-grid,[bindery-view-mode=interactive] .📖-flip,[bindery-view-mode=print] .📖-print{color:blue}.📖-select-wrap{padding:8px 16px;padding-right:28px;background:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='32' height='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 14l5 5 5-5' stroke='%23000' fill='none'/%3E%3C/svg%3E\") no-repeat 50% 50%;background-color:#f4f4f4;background-position:100%;border-radius:2px;transition:all .2s;white-space:nowrap;width:100%}.📖-select-wrap:active,.📖-select-wrap:hover{background-color:#eee}.📖-select-wrap.📖-hidden-select{max-width:0;padding-left:0;padding-right:0;border-left-width:0;border-right-width:0;color:transparent}.📖-select{position:absolute;top:0;left:0;opacity:0;-webkit-appearance:none;-moz-appearance:none;padding:8px 16px;color:#000;border:transparent;width:100%}.📖-debug-controls{display:none}.📖-debug .📖-in-progress .📖-debug-controls{display:block}.📖-refresh-btns{opacity:0;position:absolute;top:0;left:0;padding:8px 0;transition:all .2s}.📖-in-progress .📖-refresh-btns{display:none}.📖-refresh-btns a{margin-left:1em;cursor:pointer}.📖-refresh-btns a:hover{color:#000}.📖-controls .📖-options-toggle{display:none}@media screen and (max-width:720px){[bindery-view-mode=print].📖-root{padding-top:120px}.📖-controls,.📖-print-options{background:#f4f4f4}.📖-print-options{top:56px;left:0;right:0;position:fixed;margin:0 8px 0 0}.📖-print-options.📖-options-hidden{display:none}}@media screen and (max-width:500px){[bindery-view-mode=print].📖-root{padding-top:190px}.📖-print-options{flex-direction:column;align-items:stretch}.📖-hidden-select{max-width:none;max-height:0}}");var De=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(S(this,e),console.log("📖 Bindery "+p),this.autorun=t.autorun||!0,this.autoupdate=t.autoupdate||!1,this.debug=t.debug||D("debug")||!1,G.validate(t,{name:"makeBook",autorun:G.bool,content:G.any,pageSetup:G.shape({name:"pageSetup",bleed:G.length,margin:G.shape({name:"margin",top:G.length,inner:G.length,outer:G.length,bottom:G.length}),size:G.shape({name:"size",width:G.length,height:G.length})}),rules:G.array}),this.pageSetup=new ae(t.pageSetup),this.viewer=new Me({bindery:this}),this.controls=this.viewer.controls,t.startingView&&this.viewer.setMode(t.startingView),this.rules=[],t.rules&&this.addRules(t.rules),t.content)if("string"==typeof t.content){if(this.source=document.querySelector(t.content),!(this.source instanceof HTMLElement))return this.viewer.displayError("Content not specified",'Could not find element that matches selector "'+t.content+'"'),void console.error('Bindery: Could not find element that matches selector "'+t.content+'"');this.autorun&&this.makeBook()}else if("object"===x(t.content)&&t.content.url){var n=t.content.url,r=t.content.selector;this.fetchSource(n,r)}else t.content instanceof HTMLElement?(this.source=t.content,this.autorun&&this.makeBook()):console.error("Bindery: Source must be an element or selector");else this.viewer.displayError("Content not specified","You must include a source element, selector, or url"),console.error("Bindery: You must include a source element or selector")}return C(e,[{key:"fetchSource",value:function(e,t){var n=this;fetch(e).then(function(t){if(404===t.status)n.viewer.displayError("404",'Could not find file at "'+e+'"');else if(200===t.status)return t.text();return""}).then(function(e){var r=k("div");if(r.innerHTML=e,n.source=r.querySelector(t),!(n.source instanceof HTMLElement))return n.viewer.displayError("Source not specified",'Could not find element that matches selector "'+t+'"'),void console.error('Bindery: Could not find element that matches selector "'+t+'"');n.autorun&&n.makeBook()}).catch(function(t){console.error(t),"file"===window.location.href.split("://")[0]&&n.viewer.displayError("Can't fetch content from \""+e+'"',"Web pages can't fetch content unless they are on a server.")})}},{key:"cancel",value:function(){this.viewer.cancel(),document.body.classList.remove(B("viewing")),this.source.style.display=""}},{key:"addRules",value:function(e){var t=this;e.forEach(function(e){if(!(e instanceof Ge.Rule))throw Error("Bindery: The following is not an instance of Bindery.Rule and will be ignored: "+e);t.rules.push(e)})}},{key:"updateBookSilent",value:function(){var e=this;this.layoutComplete=!1,this.source.style.display="";var t=this.source.cloneNode(!0);this.source.style.display="none",document.body.classList.add(B("viewing")),this.pageSetup.updateStylesheet(),ne({content:t,rules:this.rules,success:function(t){e.viewer.book=t,e.viewer.render(),e.controls.setDone(),e.layoutComplete=!0},progress:function(){},error:function(t){e.layoutComplete=!0,e.viewer.displayError("Layout failed",t)},isDebugging:this.debug})}},{key:"makeBook",value:function(e){var t=this;if(this.source){if(this.layoutComplete=!1,!this.pageSetup.isSizeValid())return this.viewer.displayError("Page is too small","Size: "+JSON.stringify(this.pageSize)+" \n Margin: "+JSON.stringify(this.pageMargin)+" \n Try adjusting the sizes or units."),void console.error("Bindery: Cancelled pagination. Page is too small.");this.source.style.display="";var n=this.source.cloneNode(!0);this.source.style.display="none",this.viewer.clear(),document.body.classList.add(B("viewing")),this.viewer.element.classList.add(B("in-progress")),this.debug&&document.body.classList.add(B("debug")),this.pageSetup.updateStylesheet(),this.controls.setInProgress(),ne({content:n,rules:this.rules,success:function(n){t.viewer.book=n,t.viewer.render(),t.layoutComplete=!0,t.controls.setDone(),e&&e(),t.viewer.element.classList.remove(B("in-progress")),document.body.classList.remove(B("debug"))},progress:function(e){t.viewer.book=e,t.controls.updateProgress(e.pages.length),t.viewer.renderProgress()},error:function(e){t.layoutComplete=!0,t.viewer.element.classList.remove(B("in-progress")),t.viewer.displayError("Layout couldn't complete",e)},isDebugging:this.debug})}else document.body.classList.add(B("viewing"))}}],[{key:"makeBook",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.autorun=!t.autorun||t.autorun,new e(t)}}]),e}();return Object.assign(De,Ge)}();
//# sourceMappingURL=bindery.min.js.map
