<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<title>Bindery - Custom Rules</title>
  <link rel="stylesheet" type="text/css" href="style.css" />
</head>

<body>
	<script type="text/javascript" src="../../build/bindery.js"></script>
	<script>

		let shrinkingRule = Bindery.createRule({
			selector: "p",
			enlargeBy: 16,
			beforeAdd: function(element) {
				element.style.fontSize = 16 + this.enlargeBy + "px";
				this.enlargeBy = this.enlargeBy * 0.9;
			},
		});

		let rainbowRule = Bindery.createRule({
			afterBind: function(page, pageIndex, pageCount) {
				let pct = pageIndex / pageCount;
				page.bleed.style.backgroundColor = "hsl(" + (pct * 360) + ", 80%, 80%)";
			}
		});

		let foreedgeRule = Bindery.createRule({
			afterBind: function(page, pageIndex, pageCount) {
				let pct = pageIndex / pageCount;
				let edgePaint = document.createElement("div");
				if (pageIndex % 2 == 0) {
					edgePaint.style.background = "url('forward.svg') no-repeat";
					edgePaint.style.right = "-10px";
				}
				else {
					edgePaint.style.background = "url('back.svg') no-repeat";
					edgePaint.style.left = "-10px";
				}
				Object.assign(edgePaint.style, {
					backgroundPosition: (pct * 100) + "% 0",
					backgroundSize: "cover",
					width: "12px",
					position: "absolute",
					top: 0,
					bottom: 0,
				});
				page.element.appendChild(edgePaint);
			}
		});

		let binder = new Bindery({
		  source: {
				url: "content.html",
				selector: ".content"
			},
			standalone: true,
			startingViewMode: "interactive",
			pageSize: { height: 4, width: 4 },
			pageMargin: { top: 0.3, inner: 0.3, outer: 0.3, bottom: 0.3 },
		  rules: [
				rainbowRule,
				shrinkingRule,
				foreedgeRule,
			],
		});
	</script>
</body>
</html>
