<!DOCTYPE html>
<html class="book" lang="{{ page.lang | default: site.lang | default: "en" }}">

  {% include head.html %}
  <body>

    <script type="text/javascript" src='/bindery/js/bindery.umd.js'></script>
    <script type="text/javascript" src='/bindery/js/bindery-controls.min.js'></script>
    <script>
      const {
        makeBook,
        createRule,
        PageBreak,
        FullBleedPage,
        FullBleedSpread,
        RunningHeader,
        Footnote,
        Paper,
        Layout,
        Marks,
      } = Bindery;

      makeBook({
        content: {
          url: '/bindery/book-content/',
          selector: '.content',
        },
        ControlsComponent: BinderyControls,
        printSetup: {
          paper: Paper.AUTO_MARKS,
          layout: Layout.SPREADS,
          marks: Marks.BOTH,
        },
        pageSetup: {
          size: { width: '4in', height: '6in' },
          margin: {
            top: '0.6in',
            bottom: '0.5in',
            inner: '0.3in',
            outer: '0.3in',
          },
        },
        rules: [
          createRule({
            selector: '.colophon-wrap',
            beforeAdd: (el) => {
              updateColophon(el, { version: Bindery.version });
              return el;
            }
          }),
          PageBreak({
            selector: 'h2',
            position: 'before',
            continue: 'right',
          }),
          PageBreak({
            selector: 'h1',
            position: 'before',
            continue: 'right',
          }),
          FullBleedPage({
            selector: 'h1',
            continue: 'right',
          }),
          PageBreak({
            selector: '#colophon',
            position: 'before',
            continue: 'right',
          }),
          FullBleedPage({
            selector: '.logo',
            continue: 'right',
          }),
          PageBreak({
            selector: '.highlight',
            position: 'avoid',
          }),
          RunningHeader({
            render: (page) => {
              if (page.isEmpty) return '';
              if (page.isLeft) return `${page.number} · https://evanbrooks.info/bindery `;
              else if (page.isRight) {
                let section = Object.values(page.heading).join(' · ');
                if (section !== '') return `${section} · ${page.number}`;
                else return `${page.number}`;
              }
            },
          }),
          Footnote({
            selector: '.post-content a',
            render: (element, number) => {
              return '<i>' + number + '</i>: ' + element.href;
            }
          }),
        ]
      });
    </script>
    <script type='text/javascript' src='/bindery/js/moment.min.js'></script>
    <script type='text/javascript' src='/bindery/js/platform.js'></script>
    <script type='text/javascript' src='/bindery/js/colophon.js'></script>

  </body>
</html>
